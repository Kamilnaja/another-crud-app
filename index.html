<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <style>
    /* dla uproszczenia style w head */
    body {
      text-transform: uppercase;
      background-color: darkolivegreen;
      color: burlywood;
      font-family: Calibri;
      font-size: 20px;
      padding-left: 50px;
    }
    ul li {
      cursor: pointer;
    }
    li {
      padding: 10px 20px;
      border: 1px dashed white;
    }
    #closeBtn {
      display: inline-block;
      margin-left: 20px;
      cursor: pointer;
    }
    h1 {
      max-width: 50%;
    }
    .item {
      padding-left: 10px;
      padding-right: 20px;
    }
  </style>
</head>
<body>
  <h1>Aplikacja CRUD - umożliwia wyświetlanie, dodawanie, edytowanie i usuwanie elementów. </h1>
<ul id="list">

</ul>
  <button id="addBtn">Add</button>

  <input type="text" id="addInput">
  <script
      src="https://code.jquery.com/jquery-3.1.1.min.js"
      integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
      crossorigin="anonymous"></script>
  <script>
      _ = function (id) {
          return document.getElementById(id);
      };
      function insertAfter(referenceNode, newNode) {
          referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);
      }
      var app = {
          items: ['uno', '2', '3'],
          //status open gdy user wpisuje coś do formularza
          isOpen:  false,
          displayItem: function () {
              var data = "";
              for (var i = 0; i < this.items.length; i++) {
//                  data += "<li><span class='item' id=' + this.items[i] + '>" + this.items[i] + "</span></li>"';
                  data += '<li class=' + this.items[i] + '><span id=' + this.items[i] + '>' + this.items[i] + '</span></li>';
              }
              _('list').innerHTML = data;
          },

          addItem: function () {
              var newItem = document.createElement('li');
              newItem.innerHTML = _('addInput').value;
              newItem.id = newItem.innerHTML;
              _('list').appendChild(newItem);
              _('addInput').value = "";
          },

          editItem: function (e) {
              e.stopPropagation();
              var editor = e.target;
              //wyłącz przycisk edit
              //dodaj input
              //jeśli element nie ma inputa to dodaj
              function checkAndEdit (event) {
                  if (editInput.value.length !== 0) {
                      console.log(e.target.id);
                      e.target.innerHTML = editInput.value;
                  } else {
                      console.log("wpisz coś");
                  }
                  //można dodawać następne EL
                  event.stopPropagation();
              }
              var editInput = document.createElement('input');
              editInput.placeholder = 'edytuj';
              editInput.id = 'editInput';
              var editSubmit = document.createElement('button');
              //stwórz btn do potwierdzenia zmian
              editSubmit.innerHTML = "Edytuj";
              editSubmit.id = 'editSubmit';
                  editor.appendChild(editInput);
                  editor.appendChild(editSubmit);
                      _('editSubmit').addEventListener('click', checkAndEdit);
          },

          deleteItem: function (e) {
              if (e.target.childNodes.length <= 1){
                  var closeBtn = document.createElement('button');
                  closeBtn.innerHTML = 'X';
                  closeBtn.id = 'closeBtn';
                  var elementToErase = _(e.target.id);

                  insertAfter(elementToErase, closeBtn);

                   function eraseElement () {
                      if (e.target && e.target.nodeName === "LI") {
                          //dodaj zamykaczkę
                          var parent = elementToErase.parentNode;
                          parent.removeChild(elementToErase);
                      }
                  }
                  _('closeBtn').addEventListener('click', eraseElement);
              }
          }

      };

      app.displayItem();
      //event listeners
      $('#list span').click(app.editItem);
      _('addBtn').addEventListener('click', app.addItem);
  </script>
</body>
</html>
